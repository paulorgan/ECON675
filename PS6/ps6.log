-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\prorgan\Box\Classes\Econ 675\Problem Sets\PS6\ps6.log
  log type:  text
 opened on:   2 Dec 2018, 17:56:53

. 
. use HeadStart.dta

. 
. * from the appendix
. * counties are treated if povrate60 >0, not treated o/w
. * outcome var is mort_related_post
. * preintervention var is more_related_pre
. * exog post var is mort_injury_post
. 
. * packages: rdrobust, rdlocrand, rddensity, rdmulti, rdpower
. * https://sites.google.com/site/rdpackages/home
. 
. * rename variable for ease of use
. rename povrate60 pov

. rename mort_related_pre rel_pre

. rename mort_related_post rel_post

. rename mort_injury_post inj_post

. 
. ********************************************************************************
. *** Question 2: The Effect of Head Start on Child Mortality
. ********************************************************************************
. * Q2.1.1: RD Plots
. 
. * using the rdrobust package from Matias
. rdplot rel_pre pov, c(0) binselect(es) ///
>     graph_options(title("Evenly-spaced binning, IMSE-optimal", size(medium)) ///
>                                         legend(size(vsmall)))

RD Plot with evenly spaced number of bins using spacings estimators.

         Cutoff c = 0 | Left of c  Right of c        Number of obs  =       2783
----------------------+----------------------        Kernel         =    Uniform
        Number of obs |      2489         294
   Eff. Number of obs |      2489         294
  Order poly. fit (p) |         4           4
     BW poly. fit (h) |    43.990      22.372
 Number of bins scale |     1.000       1.000

Outcome: rel_pre. Running variable: pov.
---------------------------------------------
                      | Left of c  Right of c
----------------------+----------------------
        Bins selected |         5           6
   Average bin length |     8.798       3.729
    Median bin length |     8.798       3.729
----------------------+----------------------
    IMSE-optimal bins |         5           6
  Mimicking Var. bins |        47          43
----------------------+----------------------
Rel. to IMSE-optimal: | 
        Implied scale |     1.000       1.000
    WIMSE var. weight |     0.500       0.500
    WIMSE bias weight |     0.500       0.500
---------------------------------------------


. graph save "s\1_1a.gph", replace
(file s\1_1a.gph saved)

. 
. rdplot rel_pre pov, c(0) binselect(esmv) ///
>     graph_options(title("Evenly-spaced binning, variability-mimicking", size(medium
> )) ///
>                                         legend(size(vsmall)))

RD Plot with evenly spaced mimicking variance number of bins using spacings estimator
> s.

         Cutoff c = 0 | Left of c  Right of c        Number of obs  =       2783
----------------------+----------------------        Kernel         =    Uniform
        Number of obs |      2489         294
   Eff. Number of obs |      2489         294
  Order poly. fit (p) |         4           4
     BW poly. fit (h) |    43.990      22.372
 Number of bins scale |     1.000       1.000

Outcome: rel_pre. Running variable: pov.
---------------------------------------------
                      | Left of c  Right of c
----------------------+----------------------
        Bins selected |        47          43
   Average bin length |     0.936       0.520
    Median bin length |     0.936       0.520
----------------------+----------------------
    IMSE-optimal bins |         5           6
  Mimicking Var. bins |        47          43
----------------------+----------------------
Rel. to IMSE-optimal: | 
        Implied scale |     9.400       7.167
    WIMSE var. weight |     0.001       0.003
    WIMSE bias weight |     0.999       0.997
---------------------------------------------


. graph save "s\1_1b.gph", replace
(file s\1_1b.gph saved)

. 
. rdplot rel_pre pov, c(0) binselect(qs) ///
>     graph_options(title("Quantile-spaced binning, IMSE-optimal", size(medium)) ///
>                                         legend(size(vsmall)))

RD Plot with quantile spaced number of bins using spacings estimators.

         Cutoff c = 0 | Left of c  Right of c        Number of obs  =       2783
----------------------+----------------------        Kernel         =    Uniform
        Number of obs |      2489         294
   Eff. Number of obs |      2489         294
  Order poly. fit (p) |         4           4
     BW poly. fit (h) |    43.990      22.372
 Number of bins scale |     1.000       1.000

Outcome: rel_pre. Running variable: pov.
---------------------------------------------
                      | Left of c  Right of c
----------------------+----------------------
        Bins selected |         5          10
   Average bin length |     8.798       2.237
    Median bin length |     7.100       1.236
----------------------+----------------------
    IMSE-optimal bins |         5          10
  Mimicking Var. bins |        44          48
----------------------+----------------------
Rel. to IMSE-optimal: | 
        Implied scale |     1.000       1.000
    WIMSE var. weight |     0.500       0.500
    WIMSE bias weight |     0.500       0.500
---------------------------------------------


. graph save "s\1_1c.gph", replace
(file s\1_1c.gph saved)

. 
. rdplot rel_pre pov, c(0) binselect(qsmv) ///
>     graph_options(title("Quantile-spaced binning, variability mimicking", size(medi
> um)) ///
>                                         legend(size(vsmall)))

RD Plot with quantile spaced mimicking variance quantile spaced using spacings estima
> tors.

         Cutoff c = 0 | Left of c  Right of c        Number of obs  =       2783
----------------------+----------------------        Kernel         =    Uniform
        Number of obs |      2489         294
   Eff. Number of obs |      2489         294
  Order poly. fit (p) |         4           4
     BW poly. fit (h) |    43.990      22.372
 Number of bins scale |     1.000       1.000

Outcome: rel_pre. Running variable: pov.
---------------------------------------------
                      | Left of c  Right of c
----------------------+----------------------
        Bins selected |        44          48
   Average bin length |     1.000       0.466
    Median bin length |     0.859       0.273
----------------------+----------------------
    IMSE-optimal bins |         5          10
  Mimicking Var. bins |        44          48
----------------------+----------------------
Rel. to IMSE-optimal: | 
        Implied scale |     8.800       4.800
    WIMSE var. weight |     0.001       0.009
    WIMSE bias weight |     0.999       0.991
---------------------------------------------


. graph save "s\1_1d.gph", replace
(file s\1_1d.gph saved)

. 
. graph combine "s\1_1a.gph" "s\1_1b.gph" "s\1_1c.gph" "s\1_1d.gph"

. graph export "s\1_1s.png", replace
(file s\1_1s.png written in PNG format)

. 
. ********************************************************************************
. * Q2.1.2: Falsification Tests
. * falsification of RD design using three methods
. 
. gen t = pov > 0

. 
. * (1) histogram plots
. twoway (hist pov if t, freq bcolor(black)) leg(lab(Treated)) ///
>            (hist pov if !t, freq bcolor(red)) leg(lab(Untreated))
leg(lab(Treated)) is not a twoway plot type
r(198);

end of do-file

r(198);

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(black)) ///
>            (hist pov if !t, freq bcolor(red)) ///
>            legend(1 "Teated" 2 "Untreated")
) required
r(100);

end of do-file

r(100);

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(black)) ///
>            (hist pov if !t, freq bcolor(red)), ///
>            legend(1 "Teated" 2 "Untreated")
option 1 not allowed
r(198);

end of do-file

r(198);

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(black)) ///
>            (hist pov if !t, freq bcolor(red)), ///
>            legend(label(1 "Teated") label(2 "Untreated"))

. graph export "s\1_2s.png", replace
(file s\1_2s.png written in PNG format)

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(black)) ///
>            (hist pov if !t, freq bcolor(red)), ///
>            legend(label(1 "Teated") label(2 "Untreated") order(2 1))

. graph export "s\1_2s.png", replace
(file s\1_2s.png written in PNG format)

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(black)) ///
>            (hist pov if !t, freq bcolor(red)), ///
>            legend(label(1 "Treated") label(2 "Untreated") order(2 1))

. graph export "s\1_2s.png", replace
(file s\1_2s.png written in PNG format)

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. twoway (hist pov if t, freq bcolor(red)) ///
>            (hist pov if !t, freq bcolor(black)), ///
>            legend(label(1 "Treated") label(2 "Untreated") order(2 1))

. graph export "s\1_2s.png", replace
(file s\1_2s.png written in PNG format)

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. gen p2 = pov^2

. gen p3 = pov^3

. gen p4 = pov^4

. gen p5 = pov^5

. gen p6 = pov^6

. 
. * empty matrix to fill with point estimates and standard errors
. matrix tbl = J(2,4,.)

. 
. * order 3 (run reg, grab ests, predict vals, plot, save for combine later)
. reg rel_post t pov p2 p3, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(4, 2778)        =       4.14
                                                Prob > F          =     0.0024
                                                R-squared         =     0.0052
                                                Root MSE          =      5.715

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.119972   .5946944    -1.88   0.060     -2.28606    .0461152
         pov |   .0439276   .0273691     1.61   0.109    -.0097382    .0975935
          p2 |   -.000286   .0010951    -0.26   0.794    -.0024333    .0018613
          p3 |  -.0000116   .0000223    -0.52   0.602    -.0000553    .0000321
       _cons |   3.280616   .3849699     8.52   0.000      2.52576    4.035472
------------------------------------------------------------------------------

. matrix tbl[1,1] = _b["t"]

. matrix tbl[2,1] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 3")

. graph save "s\2_1a.gph", replace
(file s\2_1a.gph saved)

. 
. * order 4
. reg rel_post t pov p2 p3 p4, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(5, 2777)        =       3.40
                                                Prob > F          =     0.0046
                                                R-squared         =     0.0052
                                                Root MSE          =     5.7159

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.018176   .7535121    -1.35   0.177    -2.495677    .4593244
         pov |   .0335796   .0524126     0.64   0.522     -.069192    .1363513
          p2 |  -.0001852   .0011164    -0.17   0.868    -.0023742    .0020039
          p3 |   .0000158   .0001015     0.16   0.876    -.0001831    .0002148
          p4 |   4.89e-07   1.75e-06     0.28   0.779    -2.93e-06    3.91e-06
       _cons |   3.206047    .503915     6.36   0.000     2.217961    4.194133
------------------------------------------------------------------------------

. matrix tbl[1,2] = _b["t"]

. matrix tbl[2,2] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 4")

. graph save "s\2_1b.gph", replace
(file s\2_1b.gph saved)

. 
. * order 5
. reg rel_post t pov p2 p3 p4 p5, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(6, 2776)        =       3.53
                                                Prob > F          =     0.0018
                                                R-squared         =     0.0061
                                                Root MSE          =     5.7143

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.659208   .8111913    -2.05   0.041    -3.249808   -.0686092
         pov |   .1146616   .0674717     1.70   0.089    -.0176382    .2469615
          p2 |   .0038814   .0025235     1.54   0.124    -.0010668    .0088295
          p3 |  -.0001485    .000131    -1.13   0.257    -.0004052    .0001083
          p4 |  -.0000117   6.64e-06    -1.77   0.077    -.0000248    1.28e-06
          p5 |  -1.68e-07   8.74e-08    -1.92   0.054    -3.39e-07    3.17e-09
       _cons |   3.405855   .5133951     6.63   0.000     2.399181     4.41253
------------------------------------------------------------------------------

. matrix tbl[1,3] = _b["t"]

. matrix tbl[2,3] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 5")

. graph save "s\2_1c.gph", replace
(file s\2_1c.gph saved)

. 
. * order 6
. reg rel_post t pov p2 p3 p4 p5 p6, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(6, 2775)        =          .
                                                Prob > F          =          .
                                                R-squared         =     0.0063
                                                Root MSE          =     5.7148

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.746761   .8603792    -2.03   0.042    -3.433809   -.0597126
         pov |    .126275   .0756002     1.67   0.095    -.0219634    .2745133
          p2 |   .0014792   .0034465     0.43   0.668    -.0052786    .0082371
          p3 |  -.0002803   .0002607    -1.08   0.282    -.0007914    .0002309
          p4 |  -7.26e-06   7.04e-06    -1.03   0.302    -.0000211    6.54e-06
          p5 |   1.50e-07   4.00e-07     0.37   0.708    -6.35e-07    9.35e-07
          p6 |   4.09e-09   5.38e-09     0.76   0.447    -6.45e-09    1.46e-08
       _cons |   3.549386   .5936055     5.98   0.000     2.385433    4.713339
------------------------------------------------------------------------------

. matrix tbl[1,4] = _b["t"]

. matrix tbl[2,4] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 6")

. graph save "s\2_1d.gph", replace
(file s\2_1d.gph saved)

. 
. * combine graphs
. graph combine "s\2_1a.gph" "s\2_1b.gph" "s\2_1c.gph" "s\2_1d.gph"

. graph export "s\2_1s.png", replace
(note: file s\2_1s.png not found)
(file s\2_1s.png written in PNG format)

. 
. * write table for LaTeX
. mat2txt, matrix(tbl) saving("s\2_1.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. gen p1t = pov*t

. gen p1u = pov*(1-t)

. gen p2t = p2*t

. gen p2u = p2*(1-t)

. gen p3t = p3*t

. gen p3u = p3*(1-t) 

. gen p4t = p4*t

. gen p4u = p4*(1-t)

. gen p5t = p5*t

. gen p5u = p5*(1-t)

. gen p6t = p6*t

. gen p6u = p6*(1-t)

. 
. * empty matrix to fill with point estimates and standard errors
. matrix tbl = J(2,4,.)

. 
. local base = "p1t p1u p2t p2u p3t p3u"

. 
. * order 3 (run reg, grab ests, predict vals, plot, save for combine later)
. reg rel_post t `base', vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(7, 2775)        =       2.88
                                                Prob > F          =     0.0053
                                                R-squared         =     0.0058
                                                Root MSE          =     5.7164

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.019616   .8702954    -2.32   0.020    -3.726108   -.3131237
         p1t |   .5080706   .2777961     1.83   0.068    -.0366372    1.052779
         p1u |   .0151504   .1237371     0.12   0.903    -.2274756    .2577764
         p2t |  -.0433291   .0341117    -1.27   0.204    -.1102161    .0235579
         p2u |  -.0016139   .0058524    -0.28   0.783    -.0130894    .0098616
         p3t |   .0010595   .0011545     0.92   0.359    -.0012043    .0033232
         p3u |  -.0000291   .0000804    -0.36   0.717    -.0001868    .0001286
       _cons |   3.130329   .7018138     4.46   0.000     1.754199    4.506459
------------------------------------------------------------------------------

. matrix tbl[1,1] = _b["t"]

. matrix tbl[2,1] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 3")

. graph save "s\2_2a.gph", replace
(file s\2_2a.gph saved)

. 
. * order 4
. reg rel_post t `base' p4t p4u, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(9, 2773)        =       2.96
                                                Prob > F          =     0.0017
                                                R-squared         =     0.0066
                                                Root MSE          =     5.7161

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |   -3.06474    1.08806    -2.82   0.005    -5.198229   -.9312506
         p1t |   .9604448   .5492743     1.75   0.080    -.1165831    2.037473
         p1u |     .27599   .2547699     1.08   0.279    -.2235679    .7755479
         p2t |  -.1497003   .1293066    -1.16   0.247    -.4032474    .1038467
         p2u |   .0234221   .0208022     1.13   0.260    -.0173673    .0642114
         p3t |   .0093274   .0098945     0.94   0.346    -.0100739    .0287287
         p3u |    .000817   .0006462     1.26   0.206    -.0004501    .0020841
         p4t |  -.0002005   .0002349    -0.85   0.393    -.0006612    .0002601
         p4u |   9.30e-06   6.76e-06     1.38   0.169    -3.96e-06    .0000226
       _cons |   3.754089   .9388414     4.00   0.000      1.91319    5.594988
------------------------------------------------------------------------------

. matrix tbl[1,2] = _b["t"]

. matrix tbl[2,2] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 4")

. graph save "s\2_2b.gph", replace
(file s\2_2b.gph saved)

. 
. * order 5
. reg rel_post t `base' p4t p4u p5t p5u, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(11, 2771)       =       2.83
                                                Prob > F          =     0.0011
                                                R-squared         =     0.0067
                                                Root MSE          =     5.7177

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.676265   1.286163    -2.08   0.038      -5.1982   -.1543299
         p1t |   .7886348   .9746446     0.81   0.418    -1.122468    2.699738
         p1u |   .0966375   .4054296     0.24   0.812    -.6983371    .8916121
         p2t |  -.0882354   .3250179    -0.27   0.786    -.7255371    .5490664
         p2u |   -.003638   .0517799    -0.07   0.944     -.105169    .0978931
         p3t |   .0011746   .0404272     0.03   0.977     -.078096    .0804451
         p3u |  -.0007564   .0028455    -0.27   0.790     -.006336    .0048231
         p4t |   .0002457   .0021159     0.12   0.908    -.0039031    .0043946
         p4u |  -.0000296    .000069    -0.43   0.668     -.000165    .0001057
         p5t |  -8.53e-06   .0000392    -0.22   0.828    -.0000855    .0000684
         p5u |  -3.45e-07   6.08e-07    -0.57   0.570    -1.54e-06    8.46e-07
       _cons |   3.473781   1.100665     3.16   0.002     1.315574    5.631987
------------------------------------------------------------------------------

. matrix tbl[1,3] = _b["t"]

. matrix tbl[2,3] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 5")

. graph save "s\2_2c.gph", replace
(file s\2_2c.gph saved)

. 
. * order 6
. reg rel_post t `base' p4t p4u p5t p5u p6t p6u, vce(hc2)

Linear regression                               Number of obs     =      2,783
                                                F(12, 2769)       =          .
                                                Prob > F          =          .
                                                R-squared         =     0.0078
                                                Root MSE          =     5.7169

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -4.123966   1.462035    -2.82   0.005    -6.990754   -1.257177
         p1t |   3.699801   1.402309     2.64   0.008     .9501234    6.449479
         p1u |   .2385718   .6545593     0.36   0.716    -1.044902    1.522045
         p2t |  -1.565935   .6520558    -2.40   0.016      -2.8445   -.2873702
         p2u |   .0274327   .1220862     0.22   0.822    -.2119564    .2668218
         p3t |   .2939523   .1256808     2.34   0.019     .0475147    .5403898
         p3u |   .0019753   .0099023     0.20   0.842    -.0174413    .0213919
         p4t |  -.0263873    .011392    -2.32   0.021     -.048725   -.0040495
         p4u |   .0000835   .0003882     0.22   0.830    -.0006777    .0008448
         p5t |   .0011106   .0004809     2.31   0.021     .0001677    .0020535
         p5u |   1.87e-06   7.28e-06     0.26   0.798    -.0000124    .0000161
         p6t |  -.0000176   7.61e-06    -2.31   0.021    -.0000325   -2.67e-06
         p6u |   1.64e-08   5.25e-08     0.31   0.754    -8.64e-08    1.19e-07
       _cons |   3.627494   1.250753     2.90   0.004     1.174992    6.079996
------------------------------------------------------------------------------

. matrix tbl[1,4] = _b["t"]

. matrix tbl[2,4] = _se["t"]

. capture drop pred

. predict pred
(option xb assumed; fitted values)

. twoway scatter pred pov, title("Order 6")

. graph save "s\2_2d.gph", replace
(file s\2_2d.gph saved)

. 
. * combine graphs
. graph combine "s\2_2a.gph" "s\2_2b.gph" "s\2_2c.gph" "s\2_2d.gph"

. graph export "s\2_2s.png", replace
(note: file s\2_2s.png not found)
(file s\2_2s.png written in PNG format)

. 
. * write table for LaTeX
. mat2txt, matrix(tbl) saving("s\2_2.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. matrix tbl = J(12,3,.)

. matrix tbl[1,1] = 1

. matrix tbl[4,1] = 5

. matrix tbl[7,1] = 9

. matrix tbl[10,1] = 18

. 
. * for h = 1
. reg rel_post t if abs(pov)<=1, vce(hc2)

Linear regression                               Number of obs     =         64
                                                F(1, 62)          =       6.53
                                                Prob > F          =     0.0131
                                                R-squared         =     0.0854
                                                Root MSE          =     3.8247

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.311095   .9044063    -2.56   0.013    -4.118978   -.5032127
       _cons |    3.22022   .8014279     4.02   0.000     1.618189    4.822252
------------------------------------------------------------------------------

. matrix tbl[2,1] = _b["t"]

. matrix tbl[3,1] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=1
(option xb assumed; fitted values)
(2,719 missing values generated)

. twoway scatter pred pov if abs(pov)<=1, title("Order 0, h = 1")

. graph save "s\2_3h1a.gph", replace
(file s\2_3h1a.gph saved)

. 
. reg rel_post t p1t p1u if abs(pov)<=1, vce(hc2)

Linear regression                               Number of obs     =         64
                                                F(3, 60)          =       2.24
                                                Prob > F          =     0.0930
                                                R-squared         =     0.0860
                                                Root MSE          =     3.8867

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |   -2.55966   2.072884    -1.23   0.222    -6.706045    1.586725
         p1t |   .4808698   1.655283     0.29   0.772    -2.830189    3.791929
         p1u |   .0504578   3.351869     0.02   0.988    -6.654279    6.755194
       _cons |   3.246493   1.932769     1.68   0.098    -.6196211    7.112608
------------------------------------------------------------------------------

. matrix tbl[2,2] = _b["t"]

. matrix tbl[3,2] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=1
(option xb assumed; fitted values)
(2,719 missing values generated)

. twoway scatter pred pov if abs(pov)<=1, title("Order 1, h = 1")

. graph save "s\2_3h1b.gph", replace
(file s\2_3h1b.gph saved)

. 
. reg rel_post t p1t p1u p2t p2u if abs(pov)<=1, vce(hc2)

Linear regression                               Number of obs     =         64
                                                F(5, 58)          =       2.41
                                                Prob > F          =     0.0468
                                                R-squared         =     0.1891
                                                Root MSE          =     3.7235

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -5.791349   3.223135    -1.80   0.078    -12.24315     .660456
         p1t |  -4.423473   4.413157    -1.00   0.320    -13.25737    4.410422
         p1u |   22.64563   12.29052     1.84   0.071    -1.956513    47.24777
         p2t |     5.0552   4.003318     1.26   0.212    -2.958311    13.06871
         p2u |   22.16044   11.75907     1.88   0.065      -1.3779    45.69878
       _cons |   7.243192   3.018594     2.40   0.020      1.20082    13.28556
------------------------------------------------------------------------------

. matrix tbl[2,3] = _b["t"]

. matrix tbl[3,3] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=1
(option xb assumed; fitted values)
(2,719 missing values generated)

. twoway scatter pred pov if abs(pov)<=1, title("Order 2, h = 1")

. graph save "s\2_3h1c.gph", replace
(file s\2_3h1c.gph saved)

. 
. * for h = 5
. reg rel_post t if abs(pov)<=5, vce(hc2)

Linear regression                               Number of obs     =        309
                                                F(1, 307)         =       2.36
                                                Prob > F          =     0.1258
                                                R-squared         =     0.0070
                                                Root MSE          =     5.8085

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -.9780353   .6371885    -1.53   0.126    -2.231845    .2757742
       _cons |   3.241953   .5244516     6.18   0.000     2.209978    4.273927
------------------------------------------------------------------------------

. matrix tbl[5,1] = _b["t"]

. matrix tbl[6,1] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=5
(option xb assumed; fitted values)
(2,474 missing values generated)

. twoway scatter pred pov if abs(pov)<=5, title("Order 0, h = 5")

. graph save "s\2_3h5a.gph", replace
(file s\2_3h5a.gph saved)

. 
. reg rel_post t p1t p1u if abs(pov)<=5, vce(hc2)

Linear regression                               Number of obs     =        309
                                                F(3, 305)         =       3.42
                                                Prob > F          =     0.0176
                                                R-squared         =     0.0140
                                                Root MSE          =      5.807

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.396177   1.252443    -1.91   0.057    -4.860699    .0683451
         p1t |   .4964465   .2212277     2.24   0.026     .0611207    .9317723
         p1u |   .0736154   .3358018     0.22   0.827     -.587166    .7343968
       _cons |   3.433469   1.155241     2.97   0.003     1.160217    5.706721
------------------------------------------------------------------------------

. matrix tbl[5,2] = _b["t"]

. matrix tbl[6,2] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=5
(option xb assumed; fitted values)
(2,474 missing values generated)

. twoway scatter pred pov if abs(pov)<=5, title("Order 1, h = 5")

. graph save "s\2_3h5b.gph", replace
(file s\2_3h5b.gph saved)

. 
. reg rel_post t p1t p1u p2t p2u if abs(pov)<=5, vce(hc2)

Linear regression                               Number of obs     =        309
                                                F(5, 303)         =       3.71
                                                Prob > F          =     0.0028
                                                R-squared         =     0.0193
                                                Root MSE          =     5.8106

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -4.209672   1.417135    -2.97   0.003    -6.998344   -1.420999
         p1t |   1.768917   .8021454     2.21   0.028     .1904361    3.347398
         p1u |   1.066879   1.067159     1.00   0.318    -1.033102     3.16686
         p2t |  -.2619541   .1691776    -1.55   0.123    -.5948658    .0709576
         p2u |    .195621    .217417     0.90   0.369    -.2322173    .6234594
       _cons |   4.238662   1.272887     3.33   0.001     1.733845    6.743479
------------------------------------------------------------------------------

. matrix tbl[5,3] = _b["t"]

. matrix tbl[6,3] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=5
(option xb assumed; fitted values)
(2,474 missing values generated)

. twoway scatter pred pov if abs(pov)<=5, title("Order 2, h = 5")

. graph save "s\2_3h5c.gph", replace
(file s\2_3h5c.gph saved)

. 
. * for h = 9
. reg rel_post t if abs(pov)<=9, vce(hc2)

Linear regression                               Number of obs     =        524
                                                F(1, 522)         =       2.31
                                                Prob > F          =     0.1290
                                                R-squared         =     0.0040
                                                Root MSE          =     5.3536

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -.6908659   .4543949    -1.52   0.129    -1.583533    .2018015
       _cons |     2.9886   .3332903     8.97   0.000     2.333845    3.643355
------------------------------------------------------------------------------

. matrix tbl[8,1] = _b["t"]

. matrix tbl[9,1] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=9
(option xb assumed; fitted values)
(2,259 missing values generated)

. twoway scatter pred pov if abs(pov)<=9, title("Order 0, h = 9")

. graph save "s\2_3h9a.gph", replace
(file s\2_3h9a.gph saved)

. 
. reg rel_post t p1t p1u if abs(pov) <=9, vce(hc2)

Linear regression                               Number of obs     =        524
                                                F(3, 520)         =       1.87
                                                Prob > F          =     0.1330
                                                R-squared         =     0.0083
                                                Root MSE          =     5.3523

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.895235   .9847692    -1.92   0.055     -3.82985    .0393798
         p1t |   .1839416   .1341913     1.37   0.171    -.0796822    .4475654
         p1u |   .1042099   .1405878     0.74   0.459    -.1719799    .3803997
       _cons |   3.466122   .8460048     4.10   0.000     1.804114    5.128129
------------------------------------------------------------------------------

. matrix tbl[8,2] = _b["t"]

. matrix tbl[9,2] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=9
(option xb assumed; fitted values)
(2,259 missing values generated)

. twoway scatter pred pov if abs(pov)<=9, title("Order 1, h = 9")

. graph save "s\2_3h9b.gph", replace
(file s\2_3h9b.gph saved)

. 
. reg rel_post t p1t p1u p2t p2u if abs(pov)<=9, vce(hc2)

Linear regression                               Number of obs     =        524
                                                F(5, 518)         =       2.32
                                                Prob > F          =     0.0426
                                                R-squared         =     0.0095
                                                Root MSE          =     5.3595

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.622908   1.316495    -1.99   0.047    -5.209233   -.0365832
         p1t |   .5759111    .395243     1.46   0.146    -.2005651    1.352387
         p1u |   .2270231   .4959788     0.46   0.647    -.7473542      1.2014
         p2t |  -.0467505   .0547371    -0.85   0.393    -.1542844    .0607834
         p2u |    .013807   .0484337     0.29   0.776    -.0813435    .1089576
       _cons |   3.648447   1.209614     3.02   0.003     1.272094    6.024799
------------------------------------------------------------------------------

. matrix tbl[8,3] = _b["t"]

. matrix tbl[9,3] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=9
(option xb assumed; fitted values)
(2,259 missing values generated)

. twoway scatter pred pov if abs(pov)<=9, title("Order 2, h = 9")

. graph save "s\2_3h9c.gph", replace
(file s\2_3h9c.gph saved)

. 
. * for h = 18
. reg rel_post t if abs(pov)<=18, vce(hc2)

Linear regression                               Number of obs     =        954
                                                F(1, 952)         =       1.21
                                                Prob > F          =     0.2707
                                                R-squared         =     0.0009
                                                Root MSE          =     6.2073

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -.4139927   .3756348    -1.10   0.271    -1.151161    .3231752
       _cons |   2.811383   .2621972    10.72   0.000     2.296832    3.325934
------------------------------------------------------------------------------

. matrix tbl[11,1] = _b["t"]

. matrix tbl[12,1] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=18
(option xb assumed; fitted values)
(1,829 missing values generated)

. twoway scatter pred pov if abs(pov)<=18, title("Order 0, h = 18")

. graph save "s\2_3h18a.gph", replace
(file s\2_3h18a.gph saved)

. 
. reg rel_post t p1t p1u if abs(pov)<=18, vce(hc2)

Linear regression                               Number of obs     =        954
                                                F(3, 950)         =       1.26
                                                Prob > F          =     0.2872
                                                R-squared         =     0.0025
                                                Root MSE          =      6.209

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -1.198258   .6625907    -1.81   0.071    -2.498569    .1020522
         p1t |   .0581359   .0494594     1.18   0.240    -.0389264    .1551981
         p1u |   .0448744   .0548474     0.82   0.413    -.0627615    .1525104
       _cons |   3.238262   .5415706     5.98   0.000     2.175449    4.301075
------------------------------------------------------------------------------

. matrix tbl[11,2] = _b["t"]

. matrix tbl[12,2] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=18
(option xb assumed; fitted values)
(1,829 missing values generated)

. twoway scatter pred pov if abs(pov)<=18, title("Order 1, h = 18")

. graph save "s\2_3h18b.gph", replace
(file s\2_3h18b.gph saved)

. 
. reg rel_post t p1t p1u p2t p2u if abs(pov)<=18, vce(hc2)

Linear regression                               Number of obs     =        954
                                                F(5, 948)         =       1.60
                                                Prob > F          =     0.1571
                                                R-squared         =     0.0039
                                                Root MSE          =     6.2111

------------------------------------------------------------------------------
             |             Robust HC2
    rel_post |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           t |  -2.132059   1.025189    -2.08   0.038    -4.143961   -.1201557
         p1t |   .3538412    .187256     1.89   0.059    -.0136431    .7213254
         p1u |   .1123854   .2006132     0.56   0.575    -.2813118    .5060827
         p2t |  -.0185137   .0111627    -1.66   0.098    -.0404201    .0033928
         p2u |   .0036819   .0100687     0.37   0.715    -.0160775    .0234413
       _cons |   3.447269   .8907636     3.87   0.000     1.699172    5.195365
------------------------------------------------------------------------------

. matrix tbl[11,3] = _b["t"]

. matrix tbl[12,3] = _se["t"]

. capture drop pred

. predict pred if abs(pov)<=18
(option xb assumed; fitted values)
(1,829 missing values generated)

. twoway scatter pred pov if abs(pov)<=18, title("Order 2, h = 18")

. graph save "s\2_3h18c.gph", replace
(file s\2_3h18c.gph saved)

. 
. * combine all graphs
. graph combine "s\2_3h1a.gph" "s\2_3h1b.gph" "s\2_3h1c.gph" ///
>         "s\2_3h5a.gph" "s\2_3h5b.gph" "s\2_3h5c.gph" ///
>         "s\2_3h9a.gph" "s\2_3h9b.gph" "s\2_3h9c.gph" ///
>         "s\2_3h18a.gph" "s\2_3h18b.gph" "s\2_3h18c.gph", c(3)

. graph export "s\2_3s.png", replace
(note: file s\2_3s.png not found)
(file s\2_3s.png written in PNG format)

. 
. * write table to LaTeX
. mat2txt, matrix(tbl) saving("s\2_3.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_post pov, p(0) q(1) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |        98          92            VCE method    =         NN
    Order est. (p) |         0           0
    Order bias (q) |         1           1
       BW est. (h) |     3.235       3.235
       BW bias (b) |     7.640       7.640
         rho (h/b) |     0.423       0.423

Outcome: rel_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional | -2.1137     .98967   -2.1358  0.033   -4.05344     -.173988
    Bias-corrected | -2.5561     .98967   -2.5828  0.010   -4.49581     -.616362
            Robust | -2.5561     1.2282   -2.0812  0.037   -4.96328     -.148888
--------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_post pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       234         180            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     6.811       6.811
       BW bias (b) |    10.726      10.726
         rho (h/b) |     0.635       0.635

Outcome: rel_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |  -2.409     1.2056   -1.9981  0.046   -4.77201     -.046024
    Bias-corrected | -2.7806     1.2056   -2.3064  0.021   -5.14364     -.417655
            Robust | -2.7806     1.3683   -2.0323  0.042   -5.46238     -.098916
--------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_post pov, p(2) q(3) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       269         194            VCE method    =         NN
    Order est. (p) |         2           2
    Order bias (q) |         3           3
       BW est. (h) |     7.578       7.578
       BW bias (b) |    10.680      10.680
         rho (h/b) |     0.710       0.710

Outcome: rel_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional | -3.4744     1.3684   -2.5391  0.011    -6.1564     -.792448
    Bias-corrected | -3.7789     1.3684   -2.7616  0.006   -6.46087     -1.09692
            Robust | -3.7789      1.448   -2.6097  0.009   -6.61696     -.940831
--------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_pre pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       167         139            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     4.964       4.964
       BW bias (b) |     8.531       8.531
         rho (h/b) |     0.582       0.582

Outcome: rel_pre. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional | -2.3764     2.2481   -1.0570  0.290   -6.78263      2.02987
    Bias-corrected | -1.7673     2.2481   -0.7861  0.432   -6.17357      2.63892
            Robust | -1.7673      2.675   -0.6607  0.509   -7.01018      3.47553
--------------------------------------------------------------------------------

. * check postintervention unrelated mortality
. rdrobust inj_post pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       211         169            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     6.263       6.263
       BW bias (b) |     9.349       9.349
         rho (h/b) |     0.670       0.670

Outcome: inj_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |  1.1321     3.7754   0.2999   0.764   -6.26747      8.53169
    Bias-corrected |  1.5214     3.7754   0.4030   0.687   -5.87819      8.92097
            Robust |  1.5214     4.3859   0.3469   0.729   -7.07472      10.1175
--------------------------------------------------------------------------------

. 
. ** b) Bandwidth and Kernel sensitivity
. * empty matrix to fill with results
. matrix tbl = J(3, 10, .)

. 
. * loop over bandwidths, calc for three different kernels
. forvalues h = 1(1)10 {
  2.     quiet rdrobust rel_post pov, h(`h') kernel(tri) p(1) q(2) c(0) all
  3.         matrix tbl[1, `h'] = round(e(tau_bc), .01)
  4.         quiet rdrobust rel_post pov, h(`h') kernel(uni) p(1) q(2) c(0) all
  5.         matrix tbl[2, `h'] = round(e(tau_bc), .01)
  6.         quiet rdrobust rel_post pov, h(`h') kernel(epa) p(1) q(2) c(0) all
  7.         matrix tbl[3, `h'] = round(e(tau_bc), .01)
  8. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2b.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. matrix tbl = J(3, 10, .)

. 
. * loop over bandwidths, calc for three different kernels
. forvalues h = 1(1)10 {
  2.     quiet rdrobust rel_post pov, h(`h') kernel(tri) p(1) q(2) c(0) all
  3.         matrix tbl[1, `h'] = round(e(tau_bc), .001)
  4.         quiet rdrobust rel_post pov, h(`h') kernel(uni) p(1) q(2) c(0) all
  5.         matrix tbl[2, `h'] = round(e(tau_bc), .001)
  6.         quiet rdrobust rel_post pov, h(`h') kernel(epa) p(1) q(2) c(0) all
  7.         matrix tbl[3, `h'] = round(e(tau_bc), .001)
  8. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2b.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. matrix tbl = J(3, 10, .)

. 
. * loop over bandwidths, calc for three different kernels
. forvalues h = 1(1)10 {
  2.     quiet rdrobust rel_post pov, h(`h') kernel(tri) p(1) q(2) c(0) all
  3.         matrix tbl[1, `h'] = round(e(tau_bc), .01)
  4.         quiet rdrobust rel_post pov, h(`h') kernel(uni) p(1) q(2) c(0) all
  5.         matrix tbl[2, `h'] = round(e(tau_bc), .01)
  6.         quiet rdrobust rel_post pov, h(`h') kernel(epa) p(1) q(2) c(0) all
  7.         matrix tbl[3, `h'] = round(e(tau_bc), .01)
  8. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2b.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. gen pov_abs = abs(pov)

. sort pov_abs

. drop pov_abs

. 
. * empty matrix to fill with results
. matrix tbl = J(1, 10, .)

. 
. * loop over 10 l's
. forvalues l = 1(1)10 {
  2.     quiet rdrobust rel_post pov if _n>`l', p(1) q(2) c(0) all
  3.         matrix tbl[1, `l'] = round(e(tau_bc), .01)
  4. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2c.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. matrix tbl = J(2, 10, .)

. 
. * loop over various cutoffs, save point estimates and p-values
. forvalues c = -10(2)10 {
  2.     if `c' != 0 {
  3.             quiet rdrobust rel_post pov, c(`c') p(1) q(2) all
  4.                 * to know which matrix position to store in
.                 if `c' < 0 { 
  5.                     local i = `c'/2 + 6 
  6.                 }
  7.                 if `c' > 0 { 
  8.                     local i = `c'/2 + 5 
  9.                 }
 10.                 matrix tbl[1, `i'] = round(e(tau_bc), .01)
 11.                 matrix tbl[2, `i'] = round(e(pv_rb), .01)
 12.         }
 13. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2d.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_pre pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       167         139            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     4.964       4.964
       BW bias (b) |     8.531       8.531
         rho (h/b) |     0.582       0.582

Outcome: rel_pre. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional | -2.3764     2.2481   -1.0570  0.290   -6.78263      2.02987
    Bias-corrected | -1.7673     2.2481   -0.7861  0.432   -6.17357      2.63892
            Robust | -1.7673      2.675   -0.6607  0.509   -7.01018      3.47553
--------------------------------------------------------------------------------

. * check postintervention unrelated mortality
. rdrobust inj_post pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       211         169            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     6.263       6.263
       BW bias (b) |     9.349       9.349
         rho (h/b) |     0.670       0.670

Outcome: inj_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |  1.1321     3.7754   0.2999   0.764   -6.26747      8.53169
    Bias-corrected |  1.5214     3.7754   0.4030   0.687   -5.87819      8.92097
            Robust |  1.5214     4.3859   0.3469   0.729   -7.07472      10.1175
--------------------------------------------------------------------------------

. 
. ** b) Bandwidth and Kernel sensitivity
. * empty matrix to fill with results
. matrix tbl = J(3, 10, .)

. 
. * loop over bandwidths, calc for three different kernels
. forvalues h = 1(1)10 {
  2.     quiet rdrobust rel_post pov, h(`h') kernel(tri) p(1) q(2) c(0) all
  3.         matrix tbl[1, `h'] = round(e(tau_bc), .01)
  4.         quiet rdrobust rel_post pov, h(`h') kernel(uni) p(1) q(2) c(0) all
  5.         matrix tbl[2, `h'] = round(e(tau_bc), .01)
  6.         quiet rdrobust rel_post pov, h(`h') kernel(epa) p(1) q(2) c(0) all
  7.         matrix tbl[3, `h'] = round(e(tau_bc), .01)
  8. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2b.txt") format(%9.4f) replace

. 
. ** c) "donut hole" approach
. * first sort by closeness for povrate to 0
. gen pov_abs = abs(pov)

. sort pov_abs

. drop pov_abs

. 
. * empty matrix to fill with results
. matrix tbl = J(1, 10, .)

. 
. * loop over 10 l's
. forvalues l = 1(1)10 {
  2.     quiet rdrobust rel_post pov if _n>`l', p(1) q(2) c(0) all
  3.         matrix tbl[1, `l'] = round(e(tau_bc), .01)
  4. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2c.txt") format(%9.4f) replace

. 
. ** d) Placebo cutoff approach
. * empty matrix to fill with results
. matrix tbl = J(2, 10, .)

. 
. * loop over various cutoffs, save point estimates and p-values
. forvalues c = -10(2)10 {
  2.     if `c' != 0 {
  3.             quiet rdrobust rel_post pov, c(`c') p(1) q(2) all
  4.                 * to know which matrix position to store in
.                 if `c' < 0 { 
  5.                     local i = `c'/2 + 6 
  6.                 }
  7.                 if `c' > 0 { 
  8.                     local i = `c'/2 + 5 
  9.                 }
 10.                 matrix tbl[1, `i'] = round(e(tau_bc), .01)
 11.                 matrix tbl[2, `i'] = round(e(pv_bc), .01)
 12.         }
 13. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2d.txt") format(%9.4f) replace

. 
end of do-file

. do "C:\Users\prorgan\AppData\Local\Temp\STD242c_000000.tmp"

. rdrobust rel_pre pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       167         139            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     4.964       4.964
       BW bias (b) |     8.531       8.531
         rho (h/b) |     0.582       0.582

Outcome: rel_pre. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional | -2.3764     2.2481   -1.0570  0.290   -6.78263      2.02987
    Bias-corrected | -1.7673     2.2481   -0.7861  0.432   -6.17357      2.63892
            Robust | -1.7673      2.675   -0.6607  0.509   -7.01018      3.47553
--------------------------------------------------------------------------------

. * check postintervention unrelated mortality
. rdrobust inj_post pov, p(1) q(2) c(0) all

Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c            Number of obs =       2783
-------------------+----------------------            BW type       =      mserd
     Number of obs |      2489         294            Kernel        = Triangular
Eff. Number of obs |       211         169            VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     6.263       6.263
       BW bias (b) |     9.349       9.349
         rho (h/b) |     0.670       0.670

Outcome: inj_post. Running variable: pov.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z     P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |  1.1321     3.7754   0.2999   0.764   -6.26747      8.53169
    Bias-corrected |  1.5214     3.7754   0.4030   0.687   -5.87819      8.92097
            Robust |  1.5214     4.3859   0.3469   0.729   -7.07472      10.1175
--------------------------------------------------------------------------------

. 
. ** b) Bandwidth and Kernel sensitivity
. * empty matrix to fill with results
. matrix tbl = J(3, 10, .)

. 
. * loop over bandwidths, calc for three different kernels
. forvalues h = 1(1)10 {
  2.     quiet rdrobust rel_post pov, h(`h') kernel(tri) p(1) q(2) c(0) all
  3.         matrix tbl[1, `h'] = round(e(tau_bc), .01)
  4.         quiet rdrobust rel_post pov, h(`h') kernel(uni) p(1) q(2) c(0) all
  5.         matrix tbl[2, `h'] = round(e(tau_bc), .01)
  6.         quiet rdrobust rel_post pov, h(`h') kernel(epa) p(1) q(2) c(0) all
  7.         matrix tbl[3, `h'] = round(e(tau_bc), .01)
  8. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2b.txt") format(%9.4f) replace

. 
. ** c) "donut hole" approach
. * first sort by closeness for povrate to 0
. gen pov_abs = abs(pov)

. sort pov_abs

. drop pov_abs

. 
. * empty matrix to fill with results
. matrix tbl = J(1, 10, .)

. 
. * loop over 10 l's
. forvalues l = 1(1)10 {
  2.     quiet rdrobust rel_post pov if _n>`l', p(1) q(2) c(0) all
  3.         matrix tbl[1, `l'] = round(e(tau_bc), .01)
  4. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2c.txt") format(%9.4f) replace

. 
. ** d) Placebo cutoff approach
. * empty matrix to fill with results
. matrix tbl = J(2, 10, .)

. 
. * loop over various cutoffs, save point estimates and p-values
. forvalues c = -10(2)10 {
  2.     if `c' != 0 {
  3.             quiet rdrobust rel_post pov, c(`c') p(1) q(2) all
  4.                 * to know which matrix position to store in
.                 if `c' < 0 { 
  5.                     local i = `c'/2 + 6 
  6.                 }
  7.                 if `c' > 0 { 
  8.                     local i = `c'/2 + 5 
  9.                 }
 10.                 matrix tbl[1, `i'] = round(e(tau_bc), .01)
 11.                 matrix tbl[2, `i'] = round(e(pv_rb), .01)
 12.         }
 13. }

. 
. * write to LaTeX
. mat2txt, matrix(tbl) saving("s\3_2d.txt") format(%9.4f) replace

. 
end of do-file

. exit, clear
