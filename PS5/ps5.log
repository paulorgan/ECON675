-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\prorgan\Box\Classes\Econ 675\Problem Sets\PS5\ps5.log
  log type:  text
 opened on:  19 Nov 2018, 15:26:08

. 
. ********************************************************************************
. *** Question 2: Weak Instrument Simulations
. ********************************************************************************
. 
. * from Yingjie
. program define weak_IV, rclass
  1.     syntax [, obs(integer 200) f_stat(real 10) ]
  2.         drop _all
  3.         
.         set obs `obs'
  4.         
.         * DGP
.         gen u = rnormal()
  5.         gen v = 0.99 * u + sqrt(1-0.99^2) * rnormal()
  6.         gen z = rnormal()
  7.         
.         local gamma_0 = sqrt((`f_stat' - 1) / `obs')
  8.         gen x = `gamma_0' * z + v
  9.         gen y = u
 10.         
.         * OLS
.         qui reg y x, robust
 11.         return scalar OLS_b   = _b[x]
 12.         return scalar OLS_se  = _se[x]
 13.         return scalar OLS_rej = abs(_b[x]/_se[x]) > 1.96
 14.         
.         * 2SLS
.         qui ivregress 2sls y (x = z)
 15.         return scalar TSLS_b   = _b[x]
 16.         return scalar TSLS_se  = _se[x]
 17.         return scalar TSLS_rej = abs(_b[x]/_se[x]) > 1.96
 18.         qui reg x z
 19.         return scalar TSLS_F   = e(F)
 20. end

. 
. * simulation 1: F = 1 
. simulate OLS_b=r(OLS_b) OLS_se=r(OLS_se) OLS_rej=r(OLS_rej) ///
>     TSLS_b=r(TSLS_b) TSLS_se=r(TSLS_se) TSLS_rej=r(TSLS_rej) TSLS_F=r(TSLS_F), ///
>     reps(5000) seed(22) nodots: ///
>     weak_IV, f_stat(1)

      command:  weak_IV, f_stat(1)
        OLS_b:  r(OLS_b)
       OLS_se:  r(OLS_se)
      OLS_rej:  r(OLS_rej)
       TSLS_b:  r(TSLS_b)
      TSLS_se:  r(TSLS_se)
     TSLS_rej:  r(TSLS_rej)
       TSLS_F:  r(TSLS_F)


.         
. local k = 1

. matrix Results = J(7, 5, .)

. 
. qui sum OLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_F, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. mat2txt, matrix(Results) saving(q2_1.txt) format(%9.4f) replace

. 
. * now run for F=1.25, 10, and 100
. 
. * simulation 2: F = 1.25 
. simulate OLS_b=r(OLS_b) OLS_se=r(OLS_se) OLS_rej=r(OLS_rej) ///
>     TSLS_b=r(TSLS_b) TSLS_se=r(TSLS_se) TSLS_rej=r(TSLS_rej) TSLS_F=r(TSLS_F), ///
>     reps(5000) seed(22) nodots: ///
>     weak_IV, f_stat(1.25)

      command:  weak_IV, f_stat(1.25)
        OLS_b:  r(OLS_b)
       OLS_se:  r(OLS_se)
      OLS_rej:  r(OLS_rej)
       TSLS_b:  r(TSLS_b)
      TSLS_se:  r(TSLS_se)
     TSLS_rej:  r(TSLS_rej)
       TSLS_F:  r(TSLS_F)


.         
. local k = 1

. matrix Results = J(7, 5, .)

. 
. qui sum OLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_F, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. mat2txt, matrix(Results) saving(q2_2.txt) format(%9.4f) replace
(note: file q2_2.txt not found)

. 
. * simulation 3: F = 10
. simulate OLS_b=r(OLS_b) OLS_se=r(OLS_se) OLS_rej=r(OLS_rej) ///
>     TSLS_b=r(TSLS_b) TSLS_se=r(TSLS_se) TSLS_rej=r(TSLS_rej) TSLS_F=r(TSLS_F), ///
>     reps(5000) seed(22) nodots: ///
>     weak_IV, f_stat(10)

      command:  weak_IV, f_stat(10)
        OLS_b:  r(OLS_b)
       OLS_se:  r(OLS_se)
      OLS_rej:  r(OLS_rej)
       TSLS_b:  r(TSLS_b)
      TSLS_se:  r(TSLS_se)
     TSLS_rej:  r(TSLS_rej)
       TSLS_F:  r(TSLS_F)


.         
. local k = 1

. matrix Results = J(7, 5, .)

. 
. qui sum OLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_F, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. mat2txt, matrix(Results) saving(q2_3.txt) format(%9.4f) replace
(note: file q2_3.txt not found)

. 
. * simulation 4: F = 100 
. simulate OLS_b=r(OLS_b) OLS_se=r(OLS_se) OLS_rej=r(OLS_rej) ///
>     TSLS_b=r(TSLS_b) TSLS_se=r(TSLS_se) TSLS_rej=r(TSLS_rej) TSLS_F=r(TSLS_F), ///
>     reps(5000) seed(22) nodots: ///
>     weak_IV, f_stat(100)

      command:  weak_IV, f_stat(100)
        OLS_b:  r(OLS_b)
       OLS_se:  r(OLS_se)
      OLS_rej:  r(OLS_rej)
       TSLS_b:  r(TSLS_b)
      TSLS_se:  r(TSLS_se)
     TSLS_rej:  r(TSLS_rej)
       TSLS_F:  r(TSLS_F)


.         
. local k = 1

. matrix Results = J(7, 5, .)

. 
. qui sum OLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum OLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_b, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_se, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_rej, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. qui sum TSLS_F, detail

. matrix Results[`k',1] = r(mean)

. matrix Results[`k',2] = r(sd)

. matrix Results[`k',3] = r(p10)

. matrix Results[`k',4] = r(p50)

. matrix Results[`k',5] = r(p90)

. local k = `k' + 1

. 
. mat2txt, matrix(Results) saving(q2_4.txt) format(%9.4f) replace
(note: file q2_4.txt not found)

. 
end of do-file

